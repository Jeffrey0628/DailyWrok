- C++ typeid关键字详解 https://blog.csdn.net/gatieme/article/details/50947821
- 研究了一下toft库的Closure库，简单来说，是一个模板类，用来写方法的，是threadpool的参数类型
  - 首先建立一个Closure的基类，基类有一个Run()的虚方法
  - 创建两类普通函数和类函数的方法；每类中包括不同参数的多个（包括函数绑定0-6个，还需要传入0-6个，共49个）类模板
  - 类模板MethodClosure_Arg0_Bind3 继承自Closure基类，实现Run()方法；和是否permanent（是自删除函数的参数）
  - Run()方法主要是，
    - 执行传入的类函数，包括代入参数；
    - 定义局部的ConditionalAutoDeleter，自删除this指针，本类的
  - 在MethodClosure_ArgX_BindY之外，包了一层NewClosure的类，用来生产。
  - 自删除的类型，![1531990823746](C:\Users\YINZHE~1\AppData\Local\Temp\1531990823746.png)
- 这么说的话，BarrierClosure的逻辑是这样的，首先，定义了一个数量N，重写Run()方法，每次done->Run()是N--(线程安全的)，当N为0的时候，证明达到了调用次数，便调用真实的内层Run()。
  - 错误处理，当N--次数不够，或者设置问题，导致BarrierClosure为到达0而要退出的时候，需要把真实的内层done()删除掉，因为是new出来的。（正常情况下会自删除，不需要处理；因为正常流程的逻辑是，在执行Run()之前，不处理，执行Run()之后，delete，这是很符合逻辑的）。